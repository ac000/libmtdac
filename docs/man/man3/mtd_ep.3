.\" Automatically generated by Pandoc 3.1.11.1
.\"
.TH "mtd_ep" "3" "Jul 20, 2025" "Version 1.2.2" "libmtdac"
.SH NAME
\f[B]mtd_ep\f[R] \- send query to API endpoint
.SH LIBRARY
libmtdac, \f[I]\-lmtdac\f[R]
.SH SYNOPSIS
\f[B]#include <libmtdac/mtd.h>\f[R]
.PP
int mtd_ep(enum mtd_api_endpoint ep, const struct mtd_dsrc_ctx *dsctx,
.PD 0
.P
.PD
\ \ \ \ \ \ \ \ \ \ \ char **buf, const char *const params[]);
.SH DESCRIPTION
This function is used to send a query to a specified API endpoint.
.PP
(It replaces all the previous individual endpoint functions)
.TP
\f[B]ep\f[R]
is an enum value specifying which endpoint to query.
It is one of the enum values defined in the \f[I]mtd_api_endpoint\f[R]
enum in \f[B]libmtdac_mtd.h(3)\f[R]
.RS
.PP
You can see more information about each endpoint in
\f[B]src/api_endpoints.h\f[R]
.RE
.TP
\f[B]dsctx\f[R]
is a \f[B]struct mtd_dsrc_ctx\f[R] that defines the source of
\f[I]POST\f[R]/\f[I]PUT\f[R] data.
For endpoints that don\[cq]t take such data, this should be
\f[B]NULL\f[R].
.TP
\f[B]buf\f[R]
this is the output buffer.
It will be allocated by libmtdac and should be \f[B]free(3)\f[R]\[cq]d
by you.
.TP
\f[B]params\f[R]
this specifies the parameters required for the endpoint including any
optional or not query string.
E.g.
.RS
.PP
If an endpoint requires a \f[I]taxYear\f[R] and takes an \f[I]optional
query string\f[R], then params should have two entries, taxYear and
either a valid query string or NULL if none is being used.
.PP
The order of the entries in params \f[I]should\f[R] match the order they
are used in the endpoint URL.
.PP
It is OK to pass a params that has more entries than required, the
extras will be ignored.
.PP
There is no need to pass in how many entries is in params (or for it to
be NULL terminated) as this is dictated by each endpoint.
.PP
For any endpoints which don\[cq]t require \f[I]any\f[R] parameters, this
can be \f[B]NULL\f[R].
If an endpoint \f[I]only\f[R] takes an \f[I]optional\f[R] query stirng,
then you still need a params with a single entry either containing NULL
or a valid query string.
.PP
\f[B]NOTE:\f[R] nino (National Insurance Number) is not included in the
above as that is acquired by libmtdac via other means.
.RE
.SH RETURN VALUE
On success, zero (\f[B]MTD_ERR_NONE\f[R]) is returned.
On error, one of the below errors is returned.
.PP
\f[I]buf\f[R] will always either be returned as \f[B]NULL\f[R]
\f[I]or\f[R] a valid result buffer containing JSON which should be
\f[B]free(3)\f[R]\[cq]d.
.SH ERRORS
.TP
\f[B]MTD_ERR_OS\f[R]
There was an OS level failure.
.TP
\f[B]MTD_ERR_CURL\f[R]
There was a libcurl error.
.TP
\f[B]MTD_ERR_REQUEST\f[R]
There was an error with the request.
.SH SEE ALSO
\f[B]libmtdac(3)\f[R], \f[B]libmtdac_mtd.h(3)\f[R],
\f[B]mtd_dscrx_ctx(3type)\f[R]
